[
  {
    "UpdateStageName": "SteamCMD Download",
    "UpdateSourcePlatform": "All", 
    "UpdateSource": "SteamCMD", 
    "UpdateSourceData": "896660",
    "UpdateSourceArgs":"892970",
    "ForceDownloadPlatform":"Windows"
  },
  {
    "UpdateStageName": "Update Saves Directory - Windows",
    "UpdateSourcePlatform": "Windows",
    "UpdateSource": "Executable",
    "UpdateSourceData": "cmd.exe",
    "UpdateSourceArgs": "/C move {{$FullBaseDir}}\\Data {{$FullBaseDir}}\\Saves > NUL 2>&1",
    "SkipOnFailure":true
  },
  {
    "UpdateStageName": "Update Saves Directory - Linux",
    "UpdateSourcePlatform": "Linux",
    "UpdateSource": "Executable",
    "UpdateSourceData": "/bin/bash",
    "UpdateSourceArgs": "-c \"mv {{$FullBaseDir}}/Data/ {{$FullBaseDir}}/Saves/ >/dev/null 2>&1\"",
    "SkipOnFailure":true
  },
  {
    "UpdateStageName": "Fetch BepInEx from Thunderstore",
    "UpdateSourcePlatform": "All",
    "UpdateSource": "FetchURL",
    "UpdateSourceData": "https://gcdn.thunderstore.io/live/repository/packages/denikson-BepInExPack_Valheim-{{bepinex_version}}.zip",
    "UpdateSourceConditionSetting": "bepinex_install",
    "UpdateSourceConditionValue": "true",
    "UnzipUpdateSource": true,
    "OverwriteExistingFiles": true,
    "DeleteAfterExtract": true
  },
  {
    "UpdateStageName": "BepInEx Copy",
    "UpdateSourcePlatform": "Windows",
    "UpdateSource": "Executable",
    "UpdateSourceData": "cmd.exe",
    "UpdateSourceArgs": "/C xcopy /E /Y /I Valheim\\896660\\BepInExPack_Valheim\\* Valheim\\896660\\ > NUL 2>&1 && rmdir /Q /S Valheim\\896660\\BepInExPack_Valheim",
    "UpdateSourceConditionSetting": "bepinex_install",
    "UpdateSourceConditionValue": "true",
    "SkipOnFailure":false
  },
  {
    "UpdateStageName": "BepInEx Copy",
    "UpdateSourcePlatform": "Linux",
    "UpdateSource": "Executable",
    "UpdateSourceData": "/bin/bash",
    "UpdateSourceArgs": "-c \"cp -rf ./Valheim/896660/BepInExPack_Valheim/* ./Valheim/896660/ >/dev/null 2>&1 && rm -rf ./Valheim/896660/BepInExPack_Valheim/\"",
    "UpdateSourceConditionSetting": "bepinex_install",
    "UpdateSourceConditionValue": "true",
    "SkipOnFailure":false
  },
  {
      "UpdateStageName":"Initialise Wine",
      "UpdateSourcePlatform":"Linux",
      "UpdateSource":"Executable",
      "UpdateSourceData":"/bin/bash",
      "UpdateSourceArgs":"-c 'WINEPREFIX=\"{{$FullRootDir}}.wine\" WINEARCH=win64 WINEDLLOVERRIDES=\"mscoree,mshtml=\" WINEDEBUG=-all /usr/bin/wineboot --init --update'",
      "SkipOnFailure":false
  },
  {
      "UpdateStageName":"Disable Prefix Sound",
      "UpdateSourcePlatform":"Linux",
      "UpdateSource":"Executable",
      "UpdateSourceData":"/bin/bash",
      "UpdateSourceArgs":"-c 'cd Valheim && wget -q -N https://raw.githubusercontent.com/Winetricks/winetricks/master/src/winetricks && chmod +x winetricks; export WINEPREFIX=\"{{$FullRootDir}}.wine\"; export WINEARCH=win64; ./winetricks sound=disabled > winescript_log.txt 2>&1'",
      "SkipOnFailure":true
  },
  {
      "UpdateStageName":"Winescript Download",
      "UpdateSourcePlatform":"Linux",
      "UpdateSource":"FetchURL",
      "UpdateSourceData":"https://raw.githubusercontent.com/MillerLoren/AMPTemplates/main/valheim-winescript.sh",
      "UpdateSourceArgs":"winescript.sh",
      "UpdateSourceTarget":"{{$FullInstanceDir}}",
      "OverwriteExistingFiles":true,
      "UpdateSourceConditionSetting":"BepInExEnabled",
      "UpdateSourceConditionValue":"true"
  },
  {
      "UpdateStageName":"Install Windows Components",
      "UpdateSourcePlatform":"Linux",
      "UpdateSource":"Executable",
      "UpdateSourceData":"/bin/bash",
      "UpdateSourceArgs":"./winescript.sh",
      "UpdateSourceConditionSetting":"BepInExEnabled",
      "UpdateSourceConditionValue":"true",
      "SkipOnFailure":false
  }
]
